<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>POS System</title>

<style>
body{margin:0;font-family:Tahoma;background:#f1f5f9}
header{background:#020617;color:#fff;padding:12px;text-align:center;font-size:18px}
nav{display:flex;gap:5px;background:#020617;padding:6px}
nav button{flex:1;background:#111827;color:#fff;border:0;border-radius:8px;padding:10px}
section{padding:10px}
input,select,button{width:100%;padding:10px;border-radius:8px;font-size:14px}
button{border:0;cursor:pointer}
.btn{background:#16a34a;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
.card{background:#fff;padding:10px;border-radius:10px;margin-bottom:6px}
.hidden{display:none}
#invoice{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:8px}
#totalBox{background:#020617;color:#fff;padding:12px;border-radius:12px;text-align:center;font-size:18px}

/* Ø·Ø¨Ø§Ø¹Ø© */
@media print{
 nav,button,input,select{display:none}
 body{background:#fff}
 .card{border:1px dashed #000}
}
</style>
</head>

<body>

<header>ğŸ§¾ Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠ</header>

<nav>
 <button onclick="show('cashier')">ÙƒØ§Ø´ÙŠØ±</button>
 <button onclick="show('products')">Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
 <button onclick="show('reports')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
</nav>

<!-- Ø§Ù„ÙƒØ§Ø´ÙŠØ± -->
<section id="cashier">
 <input id="search" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
 <input id="qty" type="number" value="1" min="1">

 <button class="btn" onclick="addItem()">â• Ø¥Ø¶Ø§ÙØ©</button>

 <div id="invoice"></div>
 <div id="totalBox">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>

 <button class="btn" onclick="saveAndPrint()">ğŸ’¾ Ø­ÙØ¸ ÙˆØ·Ø¨Ø§Ø¹Ø©</button>
</section>

<!-- Ø§Ù„Ø£ØµÙ†Ø§Ù -->
<section id="products" class="hidden">
 <h3>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</h3>
 <input id="pn" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
 <input id="pp" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
 <input id="pc" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
 <input id="ps" type="number" placeholder="Ø§Ù„Ù…Ø®Ø²ÙˆÙ†">
 <button class="btn" onclick="addProduct()">Ø­ÙØ¸</button>

 <h3>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
 <div id="plist"></div>
</section>

<!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
<section id="reports" class="hidden">
 <h3>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</h3>
 <div id="reportBox"></div>
 <button class="btn-danger" onclick="closeDay()">ğŸ”’ Ù‚ÙÙ„ Ø§Ù„ÙŠÙˆÙ…</button>
</section>

<script>
// ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† =====
let products = JSON.parse(localStorage.products || "[]");
let invoices = JSON.parse(localStorage.invoices || "[]");
let dailyCloses = JSON.parse(localStorage.dailyCloses || "[]");
let cart = [];

// ===== Ø£Ø¯ÙˆØ§Øª =====
function todayISO(){
 return new Date().toISOString().slice(0,10);
}

function saveAll(){
 localStorage.products = JSON.stringify(products);
 localStorage.invoices = JSON.stringify(invoices);
 localStorage.dailyCloses = JSON.stringify(dailyCloses);
}

function show(id){
 document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

function isDayClosed(date){
 return dailyCloses.some(d=>d.date === date);
}

// ===== Ø§Ù„Ø£ØµÙ†Ø§Ù =====
function addProduct(){
 if(!pn.value || pp.value<=0 || ps.value<0){
  return alert("âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ†Ù ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
 }
 products.push({
  n:pn.value.trim(),
  p:+pp.value,
  c:+pc.value||0,
  s:+ps.value
 });
 saveAll();
 renderProducts();
 pn.value=pp.value=pc.value=ps.value="";
 alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù");
}

function renderProducts(){
 plist.innerHTML="";
 products.forEach(p=>{
  plist.innerHTML+=`
   <div class="card">
    ${p.n}<br>
    Ø¨ÙŠØ¹: ${p.p} | Ù…Ø®Ø²ÙˆÙ†: ${p.s}
   </div>`;
 });
}

// ===== Ø§Ù„ÙƒØ§Ø´ÙŠØ± =====
function addItem(){
 let p = products.find(x=>x.n===search.value.trim());
 if(!p) return alert("âŒ Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
 if(p.s < qty.value) return alert("âŒ Ù†ÙØ§Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");

 cart.push({n:p.n,p:p.p,c:p.c,q:+qty.value});
 p.s -= qty.value;
 renderInvoice();
 saveAll();
}

function renderInvoice(){
 invoice.innerHTML="";
 let total=0;
 cart.forEach(i=>{
  total += i.p * i.q;
  invoice.innerHTML+=`
   <div class="card">
    ${i.n}<br>
    ${i.q} Ã— ${i.p}
   </div>`;
 });
 totalBox.innerText = "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + total;
}

function saveAndPrint(){
 if(cart.length===0) return alert("âŒ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙØ§Ø±ØºØ©");

 let date = todayISO();
 if(isDayClosed(date)) return alert("âŒ Ø§Ù„ÙŠÙˆÙ… Ù…Ù‚ÙÙˆÙ„");

 let total = cart.reduce((a,i)=>a+i.p*i.q,0);
 let profit = cart.reduce((a,i)=>a+(i.p-i.c)*i.q,0);

 invoices.push({
  no: invoices.length + 1,
  date,
  total,
  profit
 });

 saveAll();
 window.print();
 cart=[];
 renderInvoice();
 renderReport();
}

// ===== Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± =====
function renderReport(){
 let date = todayISO();
 let list = invoices.filter(i=>i.date===date);
 let total = list.reduce((a,i)=>a+i.total,0);
 let profit = list.reduce((a,i)=>a+i.profit,0);

 reportBox.innerHTML = `
  Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…: ${total}<br>
  Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ${profit}<br>
  Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±: ${list.length}
 `;
}

function closeDay(){
 let date = todayISO();
 if(isDayClosed(date)) return alert("âŒ Ø§Ù„ÙŠÙˆÙ… Ù…Ù‚ÙÙˆÙ„ Ø¨Ø§Ù„ÙØ¹Ù„");

 let list = invoices.filter(i=>i.date===date);
 dailyCloses.push({
  date,
  total:list.reduce((a,i)=>a+i.total,0),
  profit:list.reduce((a,i)=>a+i.profit,0),
  count:list.length
 });

 saveAll();
 alert("âœ… ØªÙ… Ù‚ÙÙ„ Ø§Ù„ÙŠÙˆÙ…");
}

// ===== ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ =====
renderProducts();
renderReport();
</script>

</body>
</html>
