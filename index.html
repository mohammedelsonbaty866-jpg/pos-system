<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ POS</title>

<style>
:root{
 --main:#0f172a;
 --accent:#22c55e;
 --danger:#ef4444;
 --bg:#f1f5f9;
}
body{margin:0;font-family:Tahoma;background:var(--bg)}
header{
background:linear-gradient(90deg,#020617,#0f172a);
color:#fff;padding:12px;text-align:center;font-size:18px
}
button{
padding:10px;border:0;border-radius:10px;
font-size:14px;cursor:pointer
}
.btn{background:var(--accent);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
input,select{
padding:10px;width:100%;border-radius:8px;
border:1px solid #cbd5f5;font-size:14px
}
.hidden{display:none}

/* Ù…Ù†ÙŠÙˆ */
#menu{
position:fixed;right:-220px;top:0;width:200px;height:100%;
background:#020617;color:#fff;padding:10px;
transition:.3s;z-index:9
}
#menu button{
width:100%;background:none;color:#fff;
text-align:right;padding:12px
}

/* ÙƒØ§Ø´ÙŠØ± */
#cashier{
padding:10px;
display:grid;
grid-template-rows:auto 1fr auto;
gap:10px
}
.top{
background:#fff;border-radius:12px;
padding:10px;display:grid;
grid-template-columns:2fr 1fr 1fr 1fr;
gap:6px
}
@media(max-width:768px){
.top{grid-template-columns:1fr 1fr}
}

#invoice{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
gap:8px
}
.card{
background:#fff;border-radius:12px;
padding:10px;text-align:center;
box-shadow:0 3px 8px rgba(0,0,0,.08)
}
#total{
background:#fff;padding:12px;
border-radius:12px;
font-size:18px;text-align:center
}

/* ====== Ø·Ø¨Ø§Ø¹Ø© ====== */
@media print {
  body * { visibility: hidden; }
  #print-area, #print-area * { visibility: visible; }

  #print-area{
    position:absolute;
    top:0;right:0;
    width:58mm;
    font-size:12px;
    direction:rtl;
    background:#fff
  }
  .p-center{text-align:center}
  .p-line{border-top:1px dashed #000;margin:6px 0}
}
</style>
</head>

<body>

<header id="shopTitle">Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ</header>
<button onclick="toggleMenu()" style="position:fixed;top:10px;right:10px;font-size:20px">â˜°</button>

<div id="menu">
<button onclick="show('cashier')">ğŸ§¾ Ø§Ù„ÙƒØ§Ø´ÙŠØ±</button>
<button onclick="show('products')">ğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
<button onclick="show('customers')">ğŸ‘¤ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
<button onclick="show('reports')">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
<button onclick="show('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<div id="screens">

<!-- Ø§Ù„ÙƒØ§Ø´ÙŠØ± -->
<div id="cashier">
<div class="top">
<input id="search" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="qty" type="number" value="1">
<select id="payType" onchange="toggleCustomer()">
<option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
<option value="credit">Ø¢Ø¬Ù„</option>
</select>
<select id="customer" class="hidden"></select>
<button class="btn" onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
<button class="btn" onclick="saveInvoice()">Ø­ÙØ¸</button>
</div>

<div id="invoice"></div>
<div id="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>
</div>

<!-- Ø§Ù„Ø£ØµÙ†Ø§Ù -->
<div id="products" class="hidden">
<h3>Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</h3>
<input id="pn" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="pp" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="pc" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="ps" type="number" placeholder="Ø§Ù„Ù…Ø®Ø²ÙˆÙ†">
<button class="btn" onclick="addProduct()">Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
</div>

<!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
<div id="customers" class="hidden">
<h3>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
<input id="cn" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<button class="btn" onclick="addCustomer()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="clist"></div>
</div>

<!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
<div id="reports" class="hidden">
<h3>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±: <span id="repCount"></span></h3>
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: <span id="repTotal"></span></h3>
</div>

<!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div id="settings" class="hidden">
<h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
<input id="shopName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">
<button class="btn" onclick="saveSettings()">Ø­ÙØ¸</button>
</div>

</div>

<!-- ====== ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ====== -->
<div id="print-area" style="display:none">
  <div class="p-center">
    <b id="p-shop"></b><br>
    <small>ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹</small>
  </div>
  <div class="p-line"></div>
  <div id="p-items"></div>
  <div class="p-line"></div>
  <b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="p-total"></span></b>
  <div class="p-line"></div>
  <div class="p-center">
    <small>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…</small>
  </div>
</div>

<script>
/* ====== Ø¨ÙŠØ§Ù†Ø§Øª ====== */
let products = JSON.parse(localStorage.products || "[]");
let customers = JSON.parse(localStorage.customers || "[]");
let invoices = JSON.parse(localStorage.invoices || "[]");
let settings = JSON.parse(localStorage.settings || "{}");
let cart = [];

function saveAll(){
localStorage.products=JSON.stringify(products);
localStorage.customers=JSON.stringify(customers);
localStorage.invoices=JSON.stringify(invoices);
localStorage.settings=JSON.stringify(settings);
}

/* ====== ØªÙ†Ù‚Ù„ ====== */
function toggleMenu(){
menu.style.right = menu.style.right=="0px" ? "-220px" : "0px";
}
function show(id){
document.querySelectorAll("#screens>div").forEach(d=>d.classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");
menu.style.right="-220px";
}

/* ====== Ø£ØµÙ†Ø§Ù ====== */
function addProduct(){
products.push({n:pn.value,p:+pp.value,c:+pc.value,s:+ps.value});
pn.value=pp.value=pc.value=ps.value="";
saveAll();alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù");
}

/* ====== Ø¹Ù…Ù„Ø§Ø¡ ====== */
function addCustomer(){
customers.push({n:cn.value,b:0});
cn.value="";
renderCustomers();saveAll();
}
function renderCustomers(){
clist.innerHTML="";
customer.innerHTML="<option value=''>Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„</option>";
customers.forEach((c,i)=>{
clist.innerHTML+=`<div class="card">${c.n} | Ø§Ù„Ø±ØµÙŠØ¯: ${c.b}</div>`;
customer.innerHTML+=`<option value="${i}">${c.n}</option>`;
});
}

/* ====== ÙƒØ§Ø´ÙŠØ± ====== */
function toggleCustomer(){
customer.classList.toggle("hidden",payType.value!="credit");
}
function addItem(){
let p=products.find(x=>x.n==search.value);
if(!p)return alert("Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
if(p.s<qty.value)return alert("Ù†ÙØ§Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");
cart.push({n:p.n,p:p.p,c:p.c,q:+qty.value});
p.s-=qty.value;
renderInvoice();saveAll();
}
function renderInvoice(){
invoice.innerHTML="";let t=0;
cart.forEach(i=>{
t+=i.p*i.q;
invoice.innerHTML+=`
<div class="card">
<b>${i.n}</b><br>
${i.q} Ã— ${i.p}<br>
<b>${i.q*i.p}</b>
</div>`;
});
total.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+t;
}

/* ====== Ø­ÙØ¸ ÙˆØ·Ø¨Ø§Ø¹Ø© ====== */
function saveInvoice(){
if(cart.length==0)return;
let totalVal=cart.reduce((a,i)=>a+i.p*i.q,0);
let inv={
no:invoices.length+1,
date:new Date().toLocaleString(),
type:payType.value,
total:totalVal,
items:cart
};
if(inv.type=="credit"){
if(customer.value==="")return alert("Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„");
customers[customer.value].b+=totalVal;
inv.customer=customers[customer.value].n;
}
invoices.push(inv);
printInvoice(inv);
cart=[];renderInvoice();renderCustomers();saveAll();
}

function printInvoice(inv){
document.getElementById("print-area").style.display="block";
p-shop.innerText=settings.shopName||"Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„";
p-items.innerHTML="";
inv.items.forEach(i=>{
p-items.innerHTML+=`<div>${i.n}<br>${i.q} Ã— ${i.p} = ${i.q*i.p}</div>`;
});
p-total.innerText=inv.total;
setTimeout(()=>{window.print();print-area.style.display="none"},300);
}

/* ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ====== */
function saveSettings(){
settings.shopName=shopName.value;
shopTitle.innerText=shopName.value||"Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ";
saveAll();
}

shopTitle.innerText=settings.shopName||"Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ";
renderCustomers();
</script>

</body>
</html>
