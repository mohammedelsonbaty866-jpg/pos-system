<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ POS</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
:root{
 --main:#0f172a;
 --accent:#22c55e;
 --danger:#ef4444;
 --bg:#f1f5f9;
}
body{margin:0;font-family:Tahoma;background:var(--bg)}
header{
background:linear-gradient(90deg,#020617,#0f172a);
color:#fff;padding:12px;text-align:center;font-size:18px
}
button{
padding:10px;border:0;border-radius:10px;
font-size:14px;cursor:pointer
}
.btn{background:var(--accent);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
input,select{
padding:10px;width:100%;border-radius:8px;
border:1px solid #cbd5f5;font-size:14px
}
.hidden{display:none}

/* Ù…Ù†ÙŠÙˆ Ø¬Ø§Ù†Ø¨ÙŠ */
#menu{
position:fixed;right:-220px;top:0;width:200px;height:100%;
background:#020617;color:#fff;padding:10px;
transition:.3s;z-index:9
}
#menu button{
width:100%;background:none;color:#fff;
text-align:right;padding:12px
}

/* ÙƒØ§Ø´ÙŠØ± */
#cashier{
padding:10px;
display:grid;
grid-template-rows:auto 1fr auto;
gap:10px
}
.top{
background:#fff;border-radius:12px;
padding:10px;display:grid;
grid-template-columns:2fr 1fr 1fr;
gap:6px
}
#invoice{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
gap:8px
}
.card{
background:#fff;border-radius:12px;
padding:10px;text-align:center;
box-shadow:0 3px 8px rgba(0,0,0,.08)
}
#total{
background:#fff;padding:12px;
border-radius:12px;
font-size:18px;text-align:center
}
</style>
</head>

<body>

<header id="shopTitle">Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ</header>
<button onclick="toggleMenu()" style="position:fixed;top:10px;right:10px;font-size:20px">â˜°</button>

<div id="menu">
<button onclick="show('cashier')">ğŸ§¾ Ø§Ù„ÙƒØ§Ø´ÙŠØ±</button>
<button onclick="show('products')">ğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
<button onclick="show('customers')">ğŸ‘¤ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
<button onclick="show('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<div id="screens">

<!-- Ø§Ù„ÙƒØ§Ø´ÙŠØ± -->
<div id="cashier">
<div class="top">
<input id="search" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="qty" type="number" value="1">
<select id="payType" onchange="toggleCustomer()">
<option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
<option value="credit">Ø¢Ø¬Ù„</option>
</select>
<select id="customer" class="hidden"></select>
<button class="btn" onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
<button class="btn" onclick="saveInvoice()">Ø­ÙØ¸</button>
</div>

<div id="invoice"></div>
<div id="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>
</div>

<!-- Ø§Ù„Ø£ØµÙ†Ø§Ù -->
<div id="products" class="hidden">
<h3>Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</h3>
<input id="pn" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="pp" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="pc" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="ps" type="number" placeholder="Ø§Ù„Ù…Ø®Ø²ÙˆÙ†">
<button class="btn" onclick="addProduct()">Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
</div>

<!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
<div id="customers" class="hidden">
<h3>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
<input id="cn" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<button class="btn" onclick="addCustomer()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="clist"></div>
</div>

<!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div id="settings" class="hidden">
<h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
<input id="shopName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">
<button class="btn" onclick="saveSettings()">Ø­ÙØ¸</button>
</div>

</div>

<script>
/* Ø¨ÙŠØ§Ù†Ø§Øª */
let products = JSON.parse(localStorage.getItem("products") || "[]");
let customers = JSON.parse(localStorage.getItem("customers") || "[]");
let invoices = JSON.parse(localStorage.getItem("invoices") || "[]");
let settings = JSON.parse(localStorage.getItem("settings") || "{}");
let cart = [];

/* Ø­ÙØ¸ */
function saveAll(){
localStorage.setItem("products",JSON.stringify(products));
localStorage.setItem("customers",JSON.stringify(customers));
localStorage.setItem("invoices",JSON.stringify(invoices));
localStorage.setItem("settings",JSON.stringify(settings));
}

/* Ù…Ù†ÙŠÙˆ */
function toggleMenu(){
menu.style.right = menu.style.right=="0px" ? "-220px":"0px";
}
function show(id){
document.querySelectorAll("#screens>div").forEach(d=>d.classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");
menu.style.right="-220px";
}

/* Ø£ØµÙ†Ø§Ù */
function addProduct(){
if(!pn.value||!pp.value)return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
products.push({n:pn.value,p:+pp.value,c:+pc.value,s:+ps.value});
pn.value=pp.value=pc.value=ps.value="";
saveAll();
alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù");
}

/* Ø¹Ù…Ù„Ø§Ø¡ */
function addCustomer(){
customers.push({n:cn.value,b:0});
cn.value="";
renderCustomers();
saveAll();
}
function renderCustomers(){
clist.innerHTML="";
customer.innerHTML="<option value=''>Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„</option>";
customers.forEach((c,i)=>{
clist.innerHTML+=`<div class="card">${c.n} | ${c.b}</div>`;
customer.innerHTML+=`<option value="${i}">${c.n}</option>`;
});
}

/* ÙƒØ§Ø´ÙŠØ± */
function toggleCustomer(){
customer.classList.toggle("hidden",payType.value!="credit");
}
function addItem(){
let p=products.find(x=>x.n==search.value);
if(!p)return alert("Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
if(p.s<qty.value)return alert("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± ÙƒØ§ÙÙŠ");
cart.push({n:p.n,p:p.p,c:p.c,q:+qty.value});
p.s-=qty.value;
renderInvoice();
saveAll();
}
function renderInvoice(){
invoice.innerHTML="";
let t=0;
cart.forEach(i=>{
t+=i.p*i.q;
invoice.innerHTML+=`
<div class="card">
<b>${i.n}</b><br>
${i.q} Ã— ${i.p}<br>
<b>${i.q*i.p}</b>
</div>`;
});
total.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+t;
}
function saveInvoice(){
if(cart.length==0)return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù");
let totalVal=cart.reduce((a,i)=>a+i.p*i.q,0);
if(payType.value=="credit"){
if(customer.value==="")return alert("Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„");
customers[customer.value].b+=totalVal;
}
invoices.push({date:new Date().toLocaleString(),total:totalVal,items:cart});
cart=[];
renderInvoice();
renderCustomers();
saveAll();
alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
}

/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
function saveSettings(){
settings.shopName=shopName.value;
shopTitle.innerText=shopName.value||"Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ";
saveAll();
}

/* ØªØ­Ù…ÙŠÙ„ */
shopTitle.innerText=settings.shopName||"Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ";
renderCustomers();

/* Service Worker */
if("serviceWorker" in navigator){
navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
