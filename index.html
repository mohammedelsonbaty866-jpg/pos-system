<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>POS System</title>

<style>
body{font-family:Tahoma;margin:0;background:#f1f5f9}
header{background:#020617;color:#fff;padding:12px;text-align:center}
nav{display:flex;gap:5px;padding:5px}
button{padding:10px;border:0;border-radius:8px;background:#22c55e;color:#fff}
input,select{padding:10px;width:100%;margin:5px 0}
.hidden{display:none}
.card{background:#fff;padding:10px;border-radius:10px;margin:5px 0;border:1px solid #e5e7eb}
#invoice .card{display:flex;justify-content:space-between}
#suggestions .card{cursor:pointer;background:#e5e7eb}
.total{font-weight:bold;margin:10px 0}
</style>
</head>

<body>

<header>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø¨ÙŠØ¹</header>

<nav>
<button id="goCashier">ğŸ§¾ Ø§Ù„ÙƒØ§Ø´ÙŠØ±</button>
<button id="goProducts">ğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
<button id="goCustomers">ğŸ‘¤ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
</nav>

<input id="shopName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">

<!-- Ø§Ù„ÙƒØ§Ø´ÙŠØ± -->
<section id="cashier">
<input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù">
<div id="suggestions"></div>

<input id="qty" type="number" min="1" value="1">

<select id="payType">
<option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
<option value="credit">Ø¢Ø¬Ù„</option>
</select>

<select id="customer" class="hidden"></select>

<button id="addCart">â• Ø¥Ø¶Ø§ÙØ©</button>

<div id="invoice"></div>
<div class="total" id="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>

<button id="print">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
<button id="saveInvoice">ğŸ’¾ Ø­ÙØ¸</button>
</section>

<!-- Ø§Ù„Ø£ØµÙ†Ø§Ù -->
<section id="products" class="hidden">
<input id="pn" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="pp" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="pc" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="ps" type="number" placeholder="Ø§Ù„Ù…Ø®Ø²ÙˆÙ†">
<button id="addProduct">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
<div id="plist"></div>
</section>

<!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
<section id="customers" class="hidden">
<input id="cn" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<button id="addCustomer">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
<div id="clist"></div>
</section>

<script>
document.addEventListener("DOMContentLoaded",()=>{

/* ===== DOM ===== */
const $ = id=>document.getElementById(id);
const cashier=$("cashier"),products=$("products"),customers=$("customers");

/* ===== DB ===== */
let DB=JSON.parse(localStorage.pos||'{"products":[],"customers":[],"invoices":[]}');
let cart=[];

/* ===== Helpers ===== */
const save=()=>localStorage.pos=JSON.stringify(DB);
const show=sec=>[cashier,products,customers].forEach(s=>s.classList.toggle("hidden",s!==sec));

/* ===== Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ ===== */
$("shopName").value=localStorage.shopName||"";
$("shopName").addEventListener("input",e=>localStorage.shopName=e.target.value);

/* ===== ØªÙ†Ù‚Ù„ ===== */
$("goCashier").onclick=()=>show(cashier);
$("goProducts").onclick=()=>show(products);
$("goCustomers").onclick=()=>show(customers);

/* ===== Ø§Ù„Ø£ØµÙ†Ø§Ù ===== */
$("addProduct").onclick=()=>{
 if(!$("pn").value||$("pp").value<=0||$("ps").value<0)return alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
 DB.products.push({
  id:Date.now(),
  name:$("pn").value.trim(),
  price:+$("pp").value,
  cost:+$("pc").value||0,
  stock:+$("ps").value
 });
 ["pn","pp","pc","ps"].forEach(i=>$(i).value="");
 save();renderProducts();
};

function renderProducts(){
 $("plist").innerHTML="";
 DB.products.forEach(p=>{
  $("plist").innerHTML+=`<div class="card">${p.name} | Ù…Ø®Ø²ÙˆÙ†: ${p.stock}</div>`;
 });
}

/* ===== Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ===== */
$("addCustomer").onclick=()=>{
 if(!$("cn").value)return;
 DB.customers.push({id:Date.now(),name:$("cn").value,balance:0,locked:false});
 $("cn").value="";save();renderCustomers();
};

function renderCustomers(){
 $("clist").innerHTML="";
 $("customer").innerHTML="<option value=''>Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„</option>";
 DB.customers.forEach(c=>{
  $("clist").innerHTML+=`<div class="card">${c.name} | Ø±ØµÙŠØ¯: ${c.balance}</div>`;
  if(!c.locked)$("customer").innerHTML+=`<option value="${c.id}">${c.name}</option>`;
 });
}

$("payType").onchange=e=>$("customer").classList.toggle("hidden",e.target.value!=="credit");

/* ===== Ø¨Ø­Ø« Ø¢Ù…Ù† ===== */
$("search").oninput=e=>{
 let q=e.target.value.trim();
 $("suggestions").innerHTML="";
 if(!q)return;
 DB.products.filter(p=>p.name.includes(q)).forEach(p=>{
  let d=document.createElement("div");
  d.className="card";
  d.textContent=`${p.name} | ${p.price}`;
  d.onclick=()=>{$("search").value=p.name;$("suggestions").innerHTML="";};
  $("suggestions").appendChild(d);
 });
};

/* ===== ÙƒØ§Ø´ÙŠØ± ===== */
$("addCart").onclick=()=>{
 let p=DB.products.find(x=>x.name===$("search").value);
 let q=+$("qty").value;
 if(!p||p.stock<q)return alert("ØºÙŠØ± Ù…ØªØ§Ø­");
 cart.push({...p,qty:q});
 p.stock-=q;
 $("search").value="";$("qty").value=1;
 renderInvoice();save();
};

function renderInvoice(){
 $("invoice").innerHTML="";
 let t=0;
 cart.forEach((i,idx)=>{
  t+=i.price*i.qty;
  let d=document.createElement("div");
  d.className="card";
  d.innerHTML=`${i.name} Ã— ${i.qty}`;
  let b=document.createElement("button");
  b.textContent="âŒ";
  b.onclick=()=>{cart.splice(idx,1);i.stock+=i.qty;renderInvoice();save();};
  d.appendChild(b);
  $("invoice").appendChild(d);
 });
 $("total").textContent="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+t;
}

/* ===== Ø­ÙØ¸ ===== */
$("saveInvoice").onclick=()=>{
 if(!cart.length)return;
 let total=cart.reduce((a,i)=>a+i.price*i.qty,0);
 if($("payType").value==="credit"){
  let c=DB.customers.find(x=>x.id===$("customer").value);
  if(!c)return alert("Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„");
  c.balance+=total;
 }
 DB.invoices.push({id:Date.now(),items:cart,total});
 cart=[];renderInvoice();renderCustomers();save();
 alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
};

/* ===== Ø·Ø¨Ø§Ø¹Ø© ===== */
$("print").onclick=()=>{
 if(!cart.length)return;
 let w=window.open("","p","width=300");
 w.document.write(`<h3>${localStorage.shopName||""}</h3><hr>`);
 cart.forEach(i=>w.document.write(`${i.name} Ã— ${i.qty}<br>`));
 w.document.write(`<hr><b>${$("total").textContent}</b><script>print();close()</script>`);
};

renderProducts();renderCustomers();
});
</script>

</body>
</html>
