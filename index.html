<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>POS System</title>

<style>
:root{
 --accent:#000;
 --bg:#f1f5f9;
}

body{
 margin:0;
 font-family:Tahoma;
 background:var(--bg);
}

/* ====== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ====== */
header{
 background:#020617;
 color:#fff;
 padding:12px;
 text-align:center;
 font-size:18px;
}

button{
 border:0;
 border-radius:10px;
 padding:10px;
 font-size:14px;
 cursor:pointer;
}

.btn{background:#16a34a;color:#fff}
.btn-danger{background:#dc2626;color:#fff}

input,select{
 width:100%;
 padding:10px;
 font-size:14px;
 border-radius:8px;
 border:1px solid #cbd5f5;
}

#cashier{
 padding:10px;
 display:flex;
 flex-direction:column;
 gap:10px;
}

.top-controls{
 background:#fff;
 padding:10px;
 border-radius:12px;
 display:grid;
 grid-template-columns:1fr 1fr;
 gap:8px;
}

#invoice{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
 gap:8px;
}

.card{
 background:#fff;
 border-radius:12px;
 padding:10px;
 text-align:center;
 box-shadow:0 3px 6px rgba(0,0,0,.1);
}

#totalBox{
 background:#020617;
 color:#fff;
 padding:12px;
 border-radius:12px;
 text-align:center;
 font-size:18px;
}

.bottom-actions{
 display:grid;
 grid-template-columns:1fr;
 gap:10px;
}

/* ====== ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© ====== */
@media print{
 body{background:#fff}

 header,
 .top-controls,
 .bottom-actions{
  display:none;
 }

 #cashier{
  padding:0;
 }

 #invoice{
  grid-template-columns:1fr;
  gap:4px;
 }

 .card{
  box-shadow:none;
  border:1px dashed #000;
  border-radius:0;
  font-size:12px;
 }

 #totalBox{
  background:none;
  color:#000;
  border-top:2px solid #000;
  border-radius:0;
  font-size:16px;
 }

 #printHeader{
  display:block !important;
  text-align:center;
  font-size:14px;
  margin-bottom:10px;
 }

 #printHeader h2{
  margin:0;
  font-size:18px;
 }

 #printHeader small{
  font-size:11px;
 }
}

#printHeader{display:none}
</style>
</head>

<body>

<header>ğŸ§¾ Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ§Ø´ÙŠØ±</header>

<div id="cashier">

<!-- Ø±Ø£Ø³ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© -->
<div id="printHeader">
  <h2 id="shopNamePrint">Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„</h2>
  <small id="invoiceInfo"></small>
  <hr>
</div>

<div class="top-controls">
 <input id="search" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
 <input id="qty" type="number" value="1" min="1">

 <select id="payType" onchange="toggleCustomer()">
  <option value="cash">ğŸ’µ Ù†Ù‚Ø¯ÙŠ</option>
  <option value="credit">ğŸ§¾ Ø¢Ø¬Ù„</option>
 </select>

 <select id="customer" style="display:none"></select>

 <button class="btn" onclick="addItem()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
 <button class="btn-danger" onclick="clearCart()">ğŸ—‘ Ù…Ø³Ø­</button>
</div>

<div id="invoice"></div>

<div id="totalBox">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>

<div class="bottom-actions">
 <button class="btn" onclick="saveAndPrint()">ğŸ’¾ Ø­ÙØ¸ ÙˆØ·Ø¨Ø§Ø¹Ø©</button>
</div>

</div>

<script>
let products = JSON.parse(localStorage.products || "[]");
let customers = JSON.parse(localStorage.customers || "[]");
let invoices = JSON.parse(localStorage.invoices || "[]");
let settings = JSON.parse(localStorage.settings || "{}");
let cart = [];

function saveAll(){
 localStorage.products = JSON.stringify(products);
 localStorage.customers = JSON.stringify(customers);
 localStorage.invoices = JSON.stringify(invoices);
 localStorage.settings = JSON.stringify(settings);
}

function toggleCustomer(){
 customer.style.display = payType.value === "credit" ? "block" : "none";
 renderCustomers();
}

function renderCustomers(){
 customer.innerHTML="<option value=''>Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„</option>";
 customers.forEach((c,i)=>{
  customer.innerHTML+=`<option value="${i}">${c.n}</option>`;
 });
}

function addItem(){
 let p = products.find(x=>x.n===search.value);
 if(!p) return alert("Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
 if(p.s < qty.value) return alert("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± ÙƒØ§ÙÙŠ");

 cart.push({n:p.n,p:p.p,q:+qty.value});
 p.s -= qty.value;

 renderInvoice();
 saveAll();
}

function renderInvoice(){
 invoice.innerHTML="";
 let total=0;

 cart.forEach(i=>{
  total+=i.p*i.q;
  invoice.innerHTML+=`
   <div class="card">
    ${i.n}<br>
    ${i.q} Ã— ${i.p}<br>
    <b>${i.q*i.p}</b>
   </div>
  `;
 });

 totalBox.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+total;
}

function clearCart(){
 if(confirm("Ù…Ø³Ø­ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ")){
  cart=[];
  renderInvoice();
 }
}

function saveAndPrint(){
 if(cart.length===0) return alert("Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙØ§Ø±ØºØ©");

 let total = cart.reduce((a,i)=>a+i.p*i.q,0);

 let inv={
  no:invoices.length+1,
  date:new Date().toLocaleString(),
  type:payType.value,
  total,
  items:cart
 };

 if(inv.type==="credit"){
  if(customer.value==="") return alert("Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„");
  customers[customer.value].b = (customers[customer.value].b||0) + total;
  inv.customer = customers[customer.value].n;
 }

 invoices.push(inv);
 saveAll();

 // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
 document.getElementById("shopNamePrint").innerText =
  settings.shopName || "Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„";
 document.getElementById("invoiceInfo").innerText =
  "ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù…: " + inv.no + " | " + inv.date;

 window.print();

 cart=[];
 renderInvoice();
}

renderCustomers();
</script>

</body>
</html>
