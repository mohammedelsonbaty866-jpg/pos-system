<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>POS كاشير</title>

<style>
:root{
  --main:#0f172a;
  --accent:#22c55e;
  --danger:#ef4444;
  --bg:#f1f5f9;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Tajawal,Arial;
  background:var(--bg);
}
header{
  background:linear-gradient(90deg,#020617,#0f172a);
  color:#fff;
  padding:12px;
  text-align:center;
  font-size:18px;
}
#cashier{
  display:grid;
  grid-template-columns:1.2fr 1fr;
  gap:10px;
  padding:10px;
}
@media(max-width:768px){
  #cashier{grid-template-columns:1fr}
}
.box{
  background:#fff;
  border-radius:12px;
  padding:10px;
}
h3{margin:5px 0 10px}
input,select{
  width:100%;
  padding:10px;
  margin-bottom:6px;
  border-radius:8px;
  border:1px solid #cbd5f5;
  font-size:14px;
}
#products{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
  gap:8px;
}
.product{
  background:#f8fafc;
  border-radius:10px;
  padding:10px;
  text-align:center;
  cursor:pointer;
  border:1px solid #e5e7eb;
}
.product:hover{background:#e0f2fe}
#invoice{max-height:260px;overflow:auto}
.item{
  display:flex;
  justify-content:space-between;
  padding:6px;
  border-bottom:1px dashed #ddd;
}
.total{
  font-size:18px;
  font-weight:bold;
  margin-top:6px;
}
.actions{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:8px;
  margin-top:10px;
}
button{
  padding:12px;
  font-size:15px;
  border:0;
  border-radius:10px;
  cursor:pointer;
}
.btn{background:var(--accent);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-dark{background:var(--main);color:#fff}
</style>
</head>

<body>

<header>نقطة بيع – كاشير</header>

<div id="cashier">

  <!-- الأصناف -->
  <div class="box">
    <h3>الأصناف</h3>
    <input id="search" placeholder="بحث" onkeyup="renderProducts()">
    <div id="products"></div>
  </div>

  <!-- الفاتورة -->
  <div class="box">
    <h3>الفاتورة</h3>
    <div id="invoice"></div>

    <input id="discount" type="number" placeholder="خصم">
    <select id="discountType" onchange="calcTotal()">
      <option value="value">خصم مبلغ</option>
      <option value="percent">خصم %</option>
    </select>

    <input id="tax" type="number" placeholder="ضريبة %">

    <div class="total" id="total">الإجمالي: 0</div>
    <div class="total" id="net">الصافي: 0</div>

    <div class="actions">
      <button class="btn-dark" onclick="clearInvoice()">مسح</button>
      <button class="btn" onclick="saveInvoice()">حفظ</button>
      <button class="btn-danger" onclick="printInvoice()">طباعة</button>
    </div>
  </div>

</div>

<script>
let products=JSON.parse(localStorage.products||"[]");
let cart=[];

if(products.length===0){
 products=[
  {n:"سكر",p:10,s:100},
  {n:"رز",p:20,s:50},
  {n:"زيت",p:30,s:40}
 ];
 localStorage.products=JSON.stringify(products);
}

function renderProducts(){
 let q=search.value;
 productsBox.innerHTML="";
 products.filter(p=>p.n.includes(q)).forEach((p,i)=>{
  productsBox.innerHTML+=`
   <div class="product" onclick="addItem(${i})">
    <b>${p.n}</b><br>${p.p} ج
   </div>`;
 });
}

function addItem(i){
 let p=products[i];
 if(p.s<=0)return alert("نفاد المخزون");
 let f=cart.find(x=>x.n==p.n);
 if(f)f.q++; else cart.push({n:p.n,p:p.p,q:1});
 p.s--;
 renderInvoice();
 localStorage.products=JSON.stringify(products);
}

function renderInvoice(){
 invoice.innerHTML="";
 cart.forEach(i=>{
  invoice.innerHTML+=`
   <div class="item">
    <span>${i.n} × ${i.q}</span>
    <span>${i.p*i.q}</span>
   </div>`;
 });
 calcTotal();
}

function calcTotal(){
 let total=cart.reduce((a,i)=>a+i.p*i.q,0);
 let d=+discount.value||0;
 if(discountType.value=="percent") d=total*(d/100);
 let afterDiscount=total-d;
 let t=+tax.value||0;
 let taxVal=afterDiscount*(t/100);
 let net=afterDiscount+taxVal;
 totalDiv.innerText="الإجمالي: "+total+" ج";
 netDiv.innerText="الصافي: "+net.toFixed(2)+" ج";
}
const totalDiv=document.getElementById("total");
const netDiv=document.getElementById("net");

function clearInvoice(){
 cart=[];
 discount.value=tax.value="";
 renderInvoice();
}

function saveInvoice(){
 if(cart.length==0)return alert("فاتورة فارغة");
 alert("تم حفظ الفاتورة");
 clearInvoice();
}

function printInvoice(){window.print()}

renderProducts();
</script>

</body>
</html>
