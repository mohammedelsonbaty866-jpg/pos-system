<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù†Ù‚Ø·Ø© Ø¨ÙŠØ¹ | Ø§Ù„ÙƒØ§Ø´ÙŠØ±</title>

<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="style.css">

<style>
body{
  margin:0;
  font-family:Tahoma;
  background:#f1f5f9;
}
header{
  background:#020617;
  color:#fff;
  padding:12px;
  text-align:center;
  font-size:18px;
}
.top-bar{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:8px;
  padding:10px;
  background:#fff;
}
button{
  padding:12px;
  border:0;
  border-radius:10px;
  font-size:14px;
  cursor:pointer;
}
.btn-main{background:#22c55e;color:#fff}
.btn-print{background:#0ea5e9;color:#fff}
.btn-danger{background:#ef4444;color:#fff}

input,select{
  padding:10px;
  border-radius:8px;
  border:1px solid #cbd5f5;
  font-size:14px;
  width:100%;
}

#invoice{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:8px;
  padding:10px;
}
.card{
  background:#fff;
  border-radius:12px;
  padding:10px;
  text-align:center;
  box-shadow:0 3px 8px rgba(0,0,0,.08)
}

.total-box{
  background:#fff;
  padding:15px;
  font-size:20px;
  text-align:center;
  margin:10px;
  border-radius:12px;
}
.hidden{display:none}

/* Ø·Ø¨Ø§Ø¹Ø© */
@media print{
  body{background:#fff}
  .top-bar,.actions{display:none}
}
</style>
</head>

<body>

<header id="shopName">Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ÙŠØ±</header>

<div class="top-bar">
  <input id="search" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ø£Ùˆ Ø¨Ø§Ø±ÙƒÙˆØ¯">
  <input id="qty" type="number" value="1">
  <select id="payType" onchange="toggleCustomer()">
    <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
    <option value="credit">Ø¢Ø¬Ù„</option>
  </select>
</div>

<div class="top-bar hidden" id="customerBox">
  <select id="customer"></select>
</div>

<div class="top-bar actions">
  <button class="btn-main" onclick="addItem()">â• Ø¥Ø¶Ø§ÙØ©</button>
  <button class="btn-print" onclick="saveAndPrint()">ğŸ’¾ Ø­ÙØ¸ + ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
  <button class="btn-danger" onclick="clearCart()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
</div>

<div id="invoice"></div>

<div class="total-box" id="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>

<script src="core.js"></script>

<script>
/* ====== INIT ====== */
const settings = getSettings();
document.getElementById("shopName").innerText = settings.shopName || "Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ÙŠØ±";

/* ====== Customers ====== */
function loadCustomers(){
  customer.innerHTML="";
  DB.customers.forEach(c=>{
    if(!c.locked){
      customer.innerHTML+=`<option value="${c.id}">${c.name}</option>`;
    }
  });
}
loadCustomers();

function toggleCustomer(){
  customerBox.classList.toggle("hidden",payType.value!=="credit");
}

/* ====== CART ====== */
function addItem(){
  const q = +qty.value;
  if(q<=0) return;

  let p = getProductByName(search.value) || getProductByBarcode(search.value);
  if(!p){ alert("Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"); return; }

  addToCart(p,q);
  renderInvoice();
  search.value="";
}

function renderInvoice(){
  invoice.innerHTML="";
  CART.forEach(i=>{
    invoice.innerHTML+=`
      <div class="card">
        <b>${i.name}</b><br>
        ${i.qty} Ã— ${i.price}<br>
        <b>${i.qty*i.price}</b>
      </div>`;
  });
  total.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+cartTotal();
}

function clearCart(){
  CART=[];
  renderInvoice();
}

/* ====== SAVE + PRINT ====== */
function saveAndPrint(){
  const type = payType.value;
  const cust = customer.value || null;
  const inv = saveInvoice(type,cust);
  if(!inv) return;

  renderInvoice();
  window.print();
}
</script>

</body>
</html>
