<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>POS System</title>

<style>
body{font-family:Tahoma;margin:0;background:#f1f5f9}
header{background:#020617;color:#fff;padding:12px;text-align:center;font-size:18px}
nav{display:flex;gap:5px;padding:5px}
button{padding:10px;border:0;border-radius:8px;background:#22c55e;color:#fff;font-size:14px}
input,select{padding:10px;width:100%;margin:5px 0;font-size:14px}
.hidden{display:none}
.card{background:#fff;padding:10px;border-radius:10px;margin:5px 0;border:1px solid #e5e7eb}
#invoice .card{display:flex;justify-content:space-between;align-items:center}
.total{font-size:18px;font-weight:bold;margin:10px 0}
#suggestions .card{cursor:pointer;background:#e5e7eb}
</style>
</head>

<body>

<header>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø¨ÙŠØ¹</header>

<nav>
<button id="btnCashier">ğŸ§¾ Ø§Ù„ÙƒØ§Ø´ÙŠØ±</button>
<button id="btnProducts">ğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
<button id="btnCustomers">ğŸ‘¤ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
</nav>

<input id="shopName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">

<!-- Ø§Ù„ÙƒØ§Ø´ÙŠØ± -->
<div id="cashier">
<input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù">
<div id="suggestions"></div>

<input id="qty" type="number" value="1" min="1">

<select id="payType">
<option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
<option value="credit">Ø¢Ø¬Ù„</option>
</select>

<select id="customer" class="hidden"></select>

<button id="btnAddCart">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„ÙØ§ØªÙˆØ±Ø©</button>

<div id="invoice"></div>
<div class="total" id="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>

<button id="btnPrint">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
<button id="btnSaveInvoice">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
</div>

<!-- Ø§Ù„Ø£ØµÙ†Ø§Ù -->
<div id="products" class="hidden">
<h3>Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</h3>
<input id="pn" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="pp" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="pc" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="ps" type="number" placeholder="Ø§Ù„Ù…Ø®Ø²ÙˆÙ†">
<button id="btnAddProduct">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
<div id="plist"></div>
</div>

<!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
<div id="customers" class="hidden">
<h3>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</h3>
<input id="cn" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<button id="btnAddCustomer">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
<div id="clist"></div>
</div>

<script>
/* ===== Ø¹Ù†Ø§ØµØ± ===== */
const cashier = document.getElementById("cashier");
const products = document.getElementById("products");
const customers = document.getElementById("customers");

const shopName = document.getElementById("shopName");
const search = document.getElementById("search");
const qty = document.getElementById("qty");
const payType = document.getElementById("payType");
const customer = document.getElementById("customer");
const invoice = document.getElementById("invoice");
const totalEl = document.getElementById("total");
const suggestions = document.getElementById("suggestions");

const pn = document.getElementById("pn");
const pp = document.getElementById("pp");
const pc = document.getElementById("pc");
const ps = document.getElementById("ps");
const plist = document.getElementById("plist");

const cn = document.getElementById("cn");
const clist = document.getElementById("clist");

/* ===== Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª ===== */
let DB = JSON.parse(localStorage.pos || '{"products":[],"customers":[],"invoices":[]}');
let cart = [];

function save(){ localStorage.pos = JSON.stringify(DB); }

/* ===== ØªÙ†Ù‚Ù„ ===== */
function show(section){
 [cashier,products,customers].forEach(d=>d.classList.add("hidden"));
 section.classList.remove("hidden");
}

/* ===== Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ ===== */
shopName.value = localStorage.shopName || "";
shopName.oninput = ()=> localStorage.shopName = shopName.value;

/* ===== Ø§Ù„Ø£ØµÙ†Ø§Ù ===== */
document.getElementById("btnAddProduct").onclick = ()=>{
 if(!pn.value || pp.value<=0 || ps.value<0) return alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
 DB.products.push({id:Date.now(),name:pn.value,price:+pp.value,cost:+pc.value||0,stock:+ps.value});
 pn.value=pp.value=pc.value=ps.value="";
 save(); renderProducts();
};

function renderProducts(){
 plist.innerHTML="";
 DB.products.forEach(p=>{
  plist.innerHTML+=`<div class="card">${p.name} | Ù…Ø®Ø²ÙˆÙ†: ${p.stock}</div>`;
 });
}

/* ===== Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ===== */
document.getElementById("btnAddCustomer").onclick = ()=>{
 if(!cn.value) return;
 DB.customers.push({id:Date.now(),name:cn.value,balance:0,locked:false});
 cn.value=""; save(); renderCustomers();
};

function renderCustomers(){
 clist.innerHTML="";
 customer.innerHTML="<option value=''>Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„</option>";
 DB.customers.forEach(c=>{
  clist.innerHTML+=`<div class="card">${c.name} | Ø±ØµÙŠØ¯: ${c.balance}</div>`;
  if(!c.locked) customer.innerHTML+=`<option value="${c.id}">${c.name}</option>`;
 });
}

payType.onchange = ()=> customer.classList.toggle("hidden",payType.value!=="credit");

/* ===== Ø§Ù„Ø¨Ø­Ø« ===== */
search.oninput = ()=>{
 let q=search.value.trim();
 suggestions.innerHTML="";
 if(!q) return;
 DB.products.filter(p=>p.name.includes(q)).forEach(p=>{
  suggestions.innerHTML+=`<div class="card" onclick="selectProduct('${p.name}')">${p.name}</div>`;
 });
};

function selectProduct(n){ search.value=n; suggestions.innerHTML=""; }

/* ===== Ø§Ù„ÙƒØ§Ø´ÙŠØ± ===== */
document.getElementById("btnAddCart").onclick = ()=>{
 let p=DB.products.find(x=>x.name===search.value);
 let q=+qty.value;
 if(!p||p.stock<q) return alert("ØºÙŠØ± Ù…ØªØ§Ø­");
 cart.push({...p,qty:q});
 p.stock-=q;
 search.value=""; qty.value=1;
 renderInvoice(); save();
};

function renderInvoice(){
 invoice.innerHTML=""; let t=0;
 cart.forEach((i,idx)=>{
  t+=i.price*i.qty;
  invoice.innerHTML+=`<div class="card">${i.name} Ã— ${i.qty}
  <button onclick="removeItem(${idx})">âŒ</button></div>`;
 });
 totalEl.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+t;
}

function removeItem(i){
 let it=cart.splice(i,1)[0];
 DB.products.find(p=>p.id===it.id).stock+=it.qty;
 renderInvoice(); save();
}

/* ===== Ø­ÙØ¸ ÙˆØ·Ø¨Ø§Ø¹Ø© ===== */
document.getElementById("btnSaveInvoice").onclick = ()=>{
 if(!cart.length) return;
 let t=cart.reduce((a,i)=>a+i.price*i.qty,0);
 if(payType.value==="credit"){
  let c=DB.customers.find(x=>x.id==customer.value);
  if(!c) return alert("Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„");
  c.balance+=t;
 }
 DB.invoices.push({id:Date.now(),items:cart,total:t});
 cart=[]; renderInvoice(); renderCustomers(); save();
 alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
};

document.getElementById("btnPrint").onclick = ()=>{
 if(!cart.length) return;
 let w=window.open("","p","width=300");
 w.document.write(`<body>${invoice.innerHTML}<script>print();close()</script></body>`);
};

/* ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ ===== */
btnCashier.onclick=()=>show(cashier);
btnProducts.onclick=()=>show(products);
btnCustomers.onclick=()=>show(customers);

/* ===== ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ ===== */
renderProducts(); renderCustomers();
</script>

</body>
</html>
